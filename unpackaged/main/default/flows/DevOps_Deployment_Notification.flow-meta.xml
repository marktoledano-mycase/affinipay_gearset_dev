<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>58.0</apiVersion>
    <assignments>
        <name>Add_Project_Pipeline_Info</name>
        <label>Add Project Pipeline Info</label>
        <locationX>867</locationX>
        <locationY>514</locationY>
        <assignmentItems>
            <assignToReference>ListChangeComponents</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>txtProjectPipeline</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Version_Info</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Remote_Change_to_Slack_Message</name>
        <label>Add Remote Change to Slack Message</label>
        <locationX>1100</locationX>
        <locationY>722</locationY>
        <assignmentItems>
            <assignToReference>ListChangeComponents</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>txtDeployComponent</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Deploy_Components</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Version_Info</name>
        <label>Add Version Info</label>
        <locationX>867</locationX>
        <locationY>352</locationY>
        <assignmentItems>
            <assignToReference>ListChangeComponents</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>txtVersionName</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Work_Items</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Work_Item_to_Slack_Message</name>
        <label>Add Work Item to Slack Message</label>
        <locationX>1235</locationX>
        <locationY>360</locationY>
        <assignmentItems>
            <assignToReference>ListChangeComponents</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>txtWorkItemName</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Work_Item_Promote</targetReference>
        </connector>
    </assignments>
    <constants>
        <name>con_LineBreak</name>
        <dataType>String</dataType>
        <value>
            <stringValue></stringValue>
        </value>
    </constants>
    <environments>Default</environments>
    <interviewLabel>DevOps Deployment Notification {!$Flow.CurrentDateTime}</interviewLabel>
    <label>DevOps Deployment Notification</label>
    <loops>
        <name>Loop_Deploy_Components</name>
        <label>Loop Deploy Components</label>
        <locationX>1104</locationX>
        <locationY>477</locationY>
        <collectionReference>varDeployComponents</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Remote_Change_to_Slack_Message</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Work_Items</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Work_Items</name>
        <label>Loop Work Items</label>
        <locationX>1102</locationX>
        <locationY>208</locationY>
        <collectionReference>Get_Work_Items</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Work_Item_to_Slack_Message</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Send_Slack_Message_with_Change_List</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Deploy_Components</name>
        <label>Get Deploy Components</label>
        <locationX>1375</locationX>
        <locationY>575</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Deploy_Components</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>sf_devops__Deployment_Result__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Work_Item_Promote.sf_devops__Deployment_Result__c</elementReference>
            </value>
        </filters>
        <object>sf_devops__Deploy_Component__c</object>
        <outputReference>varDeployComponents</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>sf_devops__Source_Component__c</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>sf_devops__Deployment_Result__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Project_Name</name>
        <label>Get Project Name</label>
        <locationX>645</locationX>
        <locationY>515</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Add_Project_Pipeline_Info</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.sf_devops__Change_Bundle__r.sf_devops__Project__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>sf_devops__Project__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Work_Item_Promote</name>
        <label>Get Work Item Promote</label>
        <locationX>1377</locationX>
        <locationY>360</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Deploy_Components</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>sf_devops__Work_Item__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_Work_Items.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>sf_devops__Work_Item_Promote__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Work_Items</name>
        <label>Get Work Items</label>
        <locationX>868</locationX>
        <locationY>208</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Work_Items</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>sf_devops__Change_Bundle__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.sf_devops__Change_Bundle__r.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>sf_devops__Work_Item__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>518</locationX>
        <locationY>192</locationY>
        <connector>
            <targetReference>Get_Project_Name</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Deployment_Result_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </filters>
        <filters>
            <field>Deployment_Result_Operation__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>SOUP_PROMOTE</stringValue>
            </value>
        </filters>
        <filters>
            <field>Environment_Name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Affinipay DevOps Main Staging</stringValue>
            </value>
        </filters>
        <object>sf_devops__Change_Bundle_Install__c</object>
        <recordTriggerType>Create</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Send_Slack_Message_with_Change_List</name>
        <label>Send Slack Message with Change List</label>
        <locationX>1367</locationX>
        <locationY>196</locationY>
        <flowName>Autolaunched_Send_Slack_Message</flowName>
        <inputAssignments>
            <name>var_SlackConversationID</name>
            <value>
                <stringValue>C05JDTT5Q5A</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_SlackMessage</name>
            <value>
                <elementReference>ListChangeComponents</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <textTemplates>
        <name>txtDeployComponent</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>`{!Loop_Deploy_Components.sf_devops__Source_Component__c}`
{!con_LineBreak}</text>
    </textTemplates>
    <textTemplates>
        <name>txtDeploymentMessage</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Work Items
{!con_LineBreak}</text>
    </textTemplates>
    <textTemplates>
        <name>txtProjectPipeline</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>:salesforce-logo: *Production Deployment | Project Pipeline: {!Get_Project_Name.Name}*
{!con_LineBreak}</text>
    </textTemplates>
    <textTemplates>
        <name>txtVersionName</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>*Version: &lt;https://affinipaymain.lightning.force.com/{!$Record.Id} | {!$Record.sf_devops__Change_Bundle__r.sf_devops__Version_Name__c}&gt;* | &lt;!date^{!$Record.sf_devops__Change_Bundle__r.LastModifiedTimestamp__c}^Released {date_num} {time}|{!$Record.sf_devops__Change_Bundle__r.LastModifiedTimestamp__c}&gt;
{!con_LineBreak}
{!con_LineBreak}</text>
    </textTemplates>
    <textTemplates>
        <name>txtWorkItemName</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>*{!Loop_Work_Items.Name}* | {!txtWorkItemSubject} | _{!Loop_Work_Items.sf_devops__Development_Environment__c}_ | {!Loop_Work_Items.sf_devops__Assigned_To__r.Full_Name__c}
{!con_LineBreak}</text>
    </textTemplates>
    <textTemplates>
        <name>txtWorkItemSubject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!Loop_Work_Items.sf_devops__Subject__c}</text>
    </textTemplates>
    <variables>
        <name>currentItem_Filter_Deploy_Components</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>sf_devops__Deploy_Component__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Deployment_Result_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>sf_devops__Deployment_Result__c</objectType>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>sf_devops__Deployment_Result__c</objectType>
    </variables>
    <variables>
        <name>ListChangeComponents</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SlackMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varChange_Submissions</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>sf_devops__Change_Submission__c</objectType>
    </variables>
    <variables>
        <name>varDeployComponents</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>sf_devops__Deploy_Component__c</objectType>
    </variables>
    <variables>
        <name>varDeploymentResults</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>sf_devops__Deployment_Result__c</objectType>
    </variables>
    <variables>
        <name>varWorkItemPromoteDRIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
