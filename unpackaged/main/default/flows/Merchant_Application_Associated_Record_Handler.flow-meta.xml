<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Slack_Message</name>
        <label>Send Slack Message</label>
        <locationX>906</locationX>
        <locationY>1082</locationY>
        <actionName>slackPostMessage</actionName>
        <actionType>slackPostMessage</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>var_Record_ID</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>slackAppIdForToken</name>
            <value>
                <stringValue>A03269G3DNE</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>slackConversationId</name>
            <value>
                <elementReference>con_Slack_Notification_Channel</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>slackMessage</name>
            <value>
                <elementReference>tex_SlackMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>slackWorkspaceIdForToken</name>
            <value>
                <stringValue>T03FBNR53</stringValue>
            </value>
        </inputParameters>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <apiVersion>57.0</apiVersion>
    <assignments>
        <name>Assignments_from_Contact</name>
        <label>Assignments from Contact</label>
        <locationX>1066</locationX>
        <locationY>603</locationY>
        <assignmentItems>
            <assignToReference>var_Record_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Contact_Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>invar_Merch_App_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Contact_Record.Merchant_App_ID__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_Account_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Contact_Record.AccountId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>App_inked_to_Contact_0</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assignments_from_Lead</name>
        <label>Assignments from Lead</label>
        <locationX>720</locationX>
        <locationY>598</locationY>
        <assignmentItems>
            <assignToReference>var_Record_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Lead_Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>invar_Merch_App_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Lead_Record.Merchant_App_ID__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_Account_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Lead_Record.Linked_Account__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>App_inked_to_Contact</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assignments_from_Opportunity</name>
        <label>Assignments from Opportunity</label>
        <locationX>1246</locationX>
        <locationY>553</locationY>
        <assignmentItems>
            <assignToReference>var_Record_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Opportunity_Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>invar_Merch_App_ID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>invr_Opportunity_Record.Merchant_App_ID__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>App_inked_to_Opportunity</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>End_Flow</name>
        <label>End Flow</label>
        <locationX>906</locationX>
        <locationY>818</locationY>
        <assignmentItems>
            <assignToReference>var_End_Flow</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>End</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Send_Slack_Message</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>End_Flow_0</name>
        <label>End Flow</label>
        <locationX>753</locationX>
        <locationY>313</locationY>
        <assignmentItems>
            <assignToReference>var_End_Flow</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>End</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <constants>
        <name>con_Slack_Notification_Channel</name>
        <dataType>String</dataType>
        <value>
            <stringValue>C04RZSNSUNT</stringValue>
        </value>
    </constants>
    <constants>
        <name>con_Souce_Contact</name>
        <dataType>String</dataType>
        <value>
            <stringValue>003</stringValue>
        </value>
    </constants>
    <constants>
        <name>con_Source_Lead</name>
        <dataType>String</dataType>
        <value>
            <stringValue>00Q</stringValue>
        </value>
    </constants>
    <constants>
        <name>con_Source_Opportunity</name>
        <dataType>String</dataType>
        <value>
            <stringValue>006</stringValue>
        </value>
    </constants>
    <decisions>
        <name>App_inked_to_Contact</name>
        <label>App Linked to Contact</label>
        <locationX>712</locationX>
        <locationY>767</locationY>
        <defaultConnector>
            <targetReference>App_Linked_to_Lead</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Contact_Link</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Lookup_Merchant_Application.Contact__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>End_Flow</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>App_inked_to_Contact_0</name>
        <label>App Linked to Contact</label>
        <locationX>1058</locationX>
        <locationY>897</locationY>
        <defaultConnector>
            <targetReference>Update_Merch_App_Contact</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Contact_Link_2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Lookup_Merchant_Application.Contact__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>End_Flow</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>App_inked_to_Opportunity</name>
        <label>App Linked to Opportunity</label>
        <locationX>1238</locationX>
        <locationY>803</locationY>
        <defaultConnector>
            <targetReference>Update_Merch_App_Opportunity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Contact_Link_Oppty</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Lookup_Merchant_Application.Opportunity__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>End_Flow</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>App_Linked_to_Lead</name>
        <label>App Linked to Lead</label>
        <locationX>711</locationX>
        <locationY>950</locationY>
        <defaultConnector>
            <targetReference>Update_Merch_App_Lead</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Linked_to_Lead</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Lookup_Merchant_Application.Lead__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>End_Flow</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Merchant_App_Record_Found</name>
        <label>Merchant App Record Found</label>
        <locationX>903</locationX>
        <locationY>315</locationY>
        <defaultConnector>
            <targetReference>End_Flow_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Lookup_Merchant_Application.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Source_Record_Object</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Source_Record_Object</name>
        <label>Source Record Object</label>
        <locationX>898</locationX>
        <locationY>498</locationY>
        <defaultConnector>
            <targetReference>End_Flow</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>ERROR</defaultConnectorLabel>
        <rules>
            <name>Lead</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>invr_Lead_Record.Id</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <elementReference>con_Source_Lead</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assignments_from_Lead</targetReference>
            </connector>
            <label>Lead</label>
        </rules>
        <rules>
            <name>Contact</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>invr_Contact_Record.Id</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <elementReference>con_Souce_Contact</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assignments_from_Contact</targetReference>
            </connector>
            <label>Contact</label>
        </rules>
        <rules>
            <name>Opportunity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>invr_Opportunity_Record.Id</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <elementReference>con_Source_Opportunity</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assignments_from_Opportunity</targetReference>
            </connector>
            <label>Opportunity</label>
        </rules>
    </decisions>
    <description>Processing flow for linking associated records to Merchant Applications</description>
    <environments>Default</environments>
    <interviewLabel>Merchant Application - Associated Record Handler {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Merchant Application - Associated Record Handler</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Looks for Merchant applications records based on the Merchant App ID</description>
        <name>Lookup_Merchant_Application</name>
        <label>Lookup Merchant Application</label>
        <locationX>909</locationX>
        <locationY>176</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Merchant_App_Record_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Merchant_App_ID__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>invar_Merch_App_ID</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Merchant_Application__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Merch_App_Contact</name>
        <label>Update Merch App Contact</label>
        <locationX>1068</locationX>
        <locationY>1085</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Lookup_Merchant_Application.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Account__c</field>
            <value>
                <elementReference>var_Account_ID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact__c</field>
            <value>
                <elementReference>var_Record_ID</elementReference>
            </value>
        </inputAssignments>
        <object>Merchant_Application__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Merch_App_Lead</name>
        <label>Update Merch App Lead</label>
        <locationX>719</locationX>
        <locationY>1105</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Lookup_Merchant_Application.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Account__c</field>
            <value>
                <elementReference>var_Account_ID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Lead__c</field>
            <value>
                <elementReference>var_Record_ID</elementReference>
            </value>
        </inputAssignments>
        <object>Merchant_Application__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Merch_App_Opportunity</name>
        <label>Update Merch App Opportunity</label>
        <locationX>1252</locationX>
        <locationY>1066</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Lookup_Merchant_Application.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Opportunity__c</field>
            <value>
                <elementReference>var_Record_ID</elementReference>
            </value>
        </inputAssignments>
        <object>Merchant_Application__c</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <start>
        <locationX>783</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>Lookup_Merchant_Application</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>tex_SlackMessage</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>:alert-blue: *Merchant Application Process Alert* 
        Record: *&lt;https://affinipaymain.lightning.force.com/{!var_Record_ID} | {!var_Record_ID}&gt;*
        This record trigger the flow but ended in the `End Flow` state</text>
    </textTemplates>
    <variables>
        <name>invar_Merch_App_ID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>invr_Contact_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>invr_Lead_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Lead</objectType>
    </variables>
    <variables>
        <name>invr_Opportunity_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>var_Account_ID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>var_End_Flow</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>var_Merch_Appliction_Update</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Merchant_Application__c</objectType>
    </variables>
    <variables>
        <description>Record ID that triggered flow</description>
        <name>var_Record_ID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>var_Slack_Message_Details</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
</Flow>
